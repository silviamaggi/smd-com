<section class="related-posts mt-5">

  <h4>You May Also Enjoy</h4>

{%- assign maxRelated = 3 -%}
{%- assign minCommonTags =  1 -%}
{%- assign maxRelatedCounter = 0 -%}

{% for post in site.posts %}

  {%- assign sameTagCount = 0 -%}
  {%- assign commonTags = '' -%}

  {% for tag in post.tags %}
    {% if post.url != page.url %}
      {% if page.tags contains tag %}
        {% assign sameTagCount = sameTagCount | plus: 1 %}
        {% capture tagmarkup %} <span class="label label-default">{{ tag }}</span> {% endcapture %}
        {% assign commonTags = commonTags | append: tagmarkup %}
      {% endif %}
    {% endif %}
  {% endfor %}

  {% if sameTagCount >= minCommonTags %}
  <article class="related-post my-4">
    <h5><a href="{{ site.url }}{{ post.url }}">{{ post.title }}</a></h5>
    <div class="small">{{ post.excerpt }}</div>
  </article>

  {%- assign maxRelatedCounter = maxRelatedCounter | plus: 1 -%}

    {% if maxRelatedCounter >= maxRelated %}
      {% break %}
    {% endif %}
  {% endif %}

{% endfor %}

</section>